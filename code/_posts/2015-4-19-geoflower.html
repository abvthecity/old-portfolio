---
layout: page
title: Geometric Flower
date: 2015-4-28
categories: Code
rgb: [112,73,18]
caption: Javascript Canvas animation of a regression flower branching into other shapes.
image: /assets/works/tree.jpg
show: true
nav: style="position:fixed;"
---

<style>
	body {
		height:100%;
		padding-bottom:1770px;
		background-color:#FFF
	}
	#tree {
		position:fixed;
		left:0;right:0;top:0;bottom:0;

	}
	#links {
		position:fixed;
		bottom:20px;
		right:20px;
		z-index:99;
		text-align:right;
		font-weight:bold;
		text-transform:uppercase;
		font-size:1.4em;
	    -webkit-touch-callout: none;
	    -webkit-user-select: none;
	    -khtml-user-select: none;
	    -moz-user-select: none;
	    -ms-user-select: none;
	    user-select: none;
	}
	#links li {
		cursor:pointer;
		padding:0px;
	}
	#links li:hover { text-decoration:underline; }

	.info {
		position: fixed;
		top: 60px;
		right: -5px;
		font-size: 20px;
		transform: rotate(90deg);
		-webkit-transform: rotate(90deg);
	}

	.info > span:after {
		display: inline;
		position: relative;
		margin-left: 15px;
		content: "\2192";
	}
</style>

<ul id="links">
	<li onclick="javascript:randomizeColor();">Change Color</li>
	<li onclick="javascript:scrollToLoc(250-250);">16.67 deg</li>
	<li onclick="javascript:scrollToLoc(675-250);">45 deg</li>
	<li onclick="javascript:scrollToLoc(900-250);">60 deg</li>
	<li onclick="javascript:scrollToLoc(1080-250);">72 deg</li>
	<li onclick="javascript:scrollToLoc(1350-250);">90 deg</li>
	<li onclick="javascript:scrollToLoc(1800-250);">120 deg</li>
	<li onclick="javascript:scrollToLoc(2020-250);">134.67 deg</li>
</ul>
<canvas id="tree"></canvas>
<div class="info"><span>Scroll</span></div>

<script>


var tree = document.getElementById("tree");
var context  = tree.getContext("2d");

var r = 0, g = 0, b = 0;

function randomizeColor() {
	r = Math.floor(Math.random()*255);
	g = Math.floor(Math.random()*255);
	b = Math.floor(Math.random()*255);
	lum = (r*0.299 + g*0.587 + b*0.114) / 256; // weighted luminance
	if (lum > 0.3 || lum < .05) randomizeColor(); // select only semi-dark colors.
	document.body.style.color = "rgba("+r+","+g+","+b+",1)";
	document.body.style.background = "rgba("+(255-r)+","+(255-g)+","+(255-b)+",1)";
	animateTree((window.scrollY+250)/10);
}


randomizeColor();

function rsize(){ 
	tree.width  = window.innerWidth;
	tree.height = window.innerHeight;
	context.translate(tree.width/2,tree.height/2);

	animate = 0;
	animateTree((window.scrollY+250)/10);

} document.onLoad = rsize(); window.addEventListener("resize", rsize);

function rscroll(){
	animate = window.scrollY;
	animateTree((animate+250)/10);
} window.addEventListener("scroll", rscroll);

function animateTree(animate) {

	angle = Math.PI*(animate/1.5)/180;

	context.clearRect ( -tree.width/2, -tree.width/2, tree.width*2, tree.height*2 );

	var unit = Math.sqrt(tree.width*tree.width + tree.height*tree.height)/100*(2.3);

	function createBranch(x,y,phi,h,theta,index){
		// x,y is the origin
		// phi is the anglular direction at the origin (radians)
		// h is the length of one twig (lets call it the hypothenuse)
		// theta is half angle between the two twigs that make up a branch (radians)

		if(index >= 9) return;

		var x_left = x + h*Math.sin(phi + theta);
		var y_left = -(y + h*Math.cos(phi + theta));
		var x_right = x - h*Math.sin(-phi + theta);
		var y_right =  -(y + h*Math.cos(-phi + theta));


		context.beginPath();

		context.moveTo(x,-y);
		context.lineTo(x_left, y_left);
		context.moveTo(x,-y);
		context.lineTo(x_right,y_right);

		alpha = 1 - index/9;
		context.strokeStyle = "rgba("+r+","+g+","+b+","+alpha+")";

		context.lineWidth = 2;
		context.stroke();

		createBranch(x_left,-y_left,phi+theta,h,theta,index+1);
		createBranch(x_right,-y_right,phi-theta,h,theta,index+1);

	}


	createBranch(0,0,0,unit,angle,0);

}

function scrollToLoc(loc) {
	var go = setInterval(function(){
		scrollLength = loc-window.scrollY;
		scrollMargin = 0;
		if(scrollLength < 0) animate = window.scrollY-10;
		else if(scrollLength > 0) animate = window.scrollY+10;

		if(scrollLength <= 10 && scrollLength >= -10) window.scrollTo(0,loc);
		else window.scrollTo(0,animate);
		if(window.scrollY == loc) clearInterval(go);
	},1);
}

</script>